table:
  name: "f5_logs"
  description: "F5 access logs processed with enhanced F5-specific metrics"
  table_type: "EXTERNAL_TABLE"
  
storage_descriptor:
  location: "s3://PROCESSED_BUCKET_PLACEHOLDER/f5-logs/"
  input_format: "org.apache.hadoop.mapred.TextInputFormat"
  output_format: "org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"
  serde_info:
    serialization_library: "org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe"

columns:
  # Timestamp fields
  - name: "timestamp_syslog"
    type: "string"
    comment: "Original syslog timestamp"
  - name: "parsed_timestamp_syslog"
    type: "timestamp"
    comment: "Parsed syslog timestamp"
  - name: "timestamp_rp"
    type: "string"
    comment: "HTTP request timestamp"
  - name: "parsed_timestamp_rp"
    type: "timestamp"
    comment: "Parsed HTTP timestamp"
    
  # Network and client info
  - name: "hostname"
    type: "string"
    comment: "Host generating the log"
  - name: "ip_cliente_externo"
    type: "string"
    comment: "External client IP"
  - name: "ip_backend_interno"
    type: "string"
    comment: "Internal backend IP"
  - name: "usuario_autenticado"
    type: "string"
    comment: "Authenticated user if any"
  - name: "identidad"
    type: "string"
    comment: "Identity field"
    
  # HTTP request details
  - name: "metodo"
    type: "string"
    comment: "HTTP method (GET, POST, etc.)"
  - name: "request"
    type: "string"
    comment: "Requested resource path"
  - name: "protocolo"
    type: "string"
    comment: "HTTP protocol version"
  - name: "codigo_respuesta"
    type: "int"
    comment: "HTTP status code"
  - name: "tamano_respuesta"
    type: "bigint"
    comment: "Response size in bytes"
    
  # Client and content info
  - name: "referer"
    type: "string"
    comment: "HTTP referer header"
  - name: "user_agent"
    type: "string"
    comment: "User agent string"
  - name: "content_type"
    type: "string"
    comment: "Content MIME type"
  - name: "jsession_id"
    type: "string"
    comment: "Java session ID"
    
  # Performance metrics
  - name: "tiempo_respuesta_ms"
    type: "bigint"
    comment: "Response time in milliseconds"
  - name: "edad_cache"
    type: "string"
    comment: "Cache age/TTL"
    
  # F5-specific fields (CRITICAL for F5 analytics)
  - name: "f5_virtualserver"
    type: "string"
    comment: "F5 VirtualServer name"
  - name: "f5_pool"
    type: "string"
    comment: "F5 Pool name"
  - name: "f5_bigip_name"
    type: "string"
    comment: "F5 BigIP node name"
    
  # Enhanced analytics fields
  - name: "is_error"
    type: "boolean"
    comment: "True if HTTP error (4xx/5xx)"
  - name: "is_slow"
    type: "boolean"
    comment: "True if response time > threshold"
  - name: "status_category"
    type: "string"
    comment: "HTTP status category (success/client_error/server_error)"
  - name: "response_time_category"
    type: "string"
    comment: "Response time category (fast/normal/slow/critical)"
  - name: "content_category"
    type: "string"
    comment: "Content type category (html/js/css/image/font/api)"
  - name: "is_mobile"
    type: "boolean"
    comment: "True if mobile device detected"
  - name: "cache_hit"
    type: "boolean"
    comment: "True if cache hit detected"
    
  # Processing metadata
  - name: "processing_timestamp"
    type: "timestamp"
    comment: "ETL processing timestamp"
  - name: "etl_version"
    type: "string"
    comment: "ETL script version"

# Partitioning strategy for optimal query performance
partition_keys:
  - name: "year"
    type: "string"
    comment: "Year partition (YYYY)"
  - name: "month"
    type: "string"
    comment: "Month partition (MM)"
  - name: "day"
    type: "string"
    comment: "Day partition (DD)"
  - name: "hour"
    type: "string"
    comment: "Hour partition (HH)"
  - name: "f5_environment"
    type: "string"
    comment: "F5 environment (TEPROD/PAPROD/etc)"

parameters:
  classification: "parquet"
  compressionType: "snappy"
  typeOfData: "file"
